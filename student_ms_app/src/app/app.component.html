<!-- <div>{{ appState$ | async | json}}</div> -->
<div class="container-xl">
  <div class="table-responsive">
    <div class="table-wrapper">
      <div class="table-title">
        <div class="row">
          <div class="col-sm-6">
            <h2>Student Management System</h2>
          </div>
          <div class="col-sm-6">
            <button  (click)="printReport()"  type="button" class="btn btn-primary">Print Report</button>
            <a
              href="#addStudentModel"
              class="btn btn-success"
              data-bs-toggle="modal"
              ><i class="material-icons">&#xE147;</i>
              <span>Add New Student</span></a
            >
            <span>
              <select [(ngModel)]="selectedGender" (ngModelChange)="filterStudents(selectedGender)"  name="gender" class="btn btn-info" title="Select Gender">
                <option value="ALL">All</option>
                <option value="MALE">Male</option>
                <option value="FEMALE">Female</option>
                <option value="OTHER">Other</option>
              </select>
            </span>
          </div>
        </div>
      </div>
      <ng-container
        *ngIf="appState$ | async as appState"
        [ngSwitch]="appState.dataState"
      >
        <ng-container *ngSwitchCase="DataState.LOADING_STATE">
          <div class="col-md-12 single-note item text-center">
            <div class="spinner-boarder text-info" role="status"></div>
          </div>
        </ng-container>
        <ng-container *ngSwitchCase="DataState.LOADED_STATE">
          <table class="table table-striped table-hover" id="students">
            <thead>
              <tr>
                <th>Student ID</th>
                <th>Student Name</th>
                <th>Student DOB</th>
                <th>Student Gender</th>
                <th>Student Age</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="
                  let student of appState.appData?.data?.students;
                  let i = index
                "
              >
                <td>{{ student.id }}</td>
                <td>{{ student.name }}</td>
                <td>{{ student.dob }}</td>
                <td>
                  <span
                    class="gender"
                    >{{ student.gender === Gender.MALE ? 'M': student.gender === Gender.FEMALE ? 'F' : 'O'}}</span
                  >
                </td>
                <td>{{ student.age }}</td>
                <td>
                  <a class="delete" data-toggle="modal" style="cursor: pointer;">
                    <i
                      class="material-icons"
                      data-bs-target="#deleteStudentModel"
                      (click)="deleteStudent(student)"
                      >&#xE872;</i
                    >
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-container *ngSwitchCase="DataState.ERROR_STATE">
          <div class="alert-danger">{{appState.error}}</div>
        </ng-container>
      </ng-container>
    </div>
  </div>
</div>

<!-- Add Model HTML -->
<div id="addStudentModel" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <form #studentForm="ngForm" (ngSubmit)="saveStudent(studentForm)" >
        <div class="modal-header">
          <h4 class="modal-title">Add Student</h4>
          <button type="button" class="close" data-bs-dismiss="modal">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Student Name</label>
            <input type="text" ngModel class="form-control" name="name" required />
          </div>
          <div class="form-group">
            <label>Student DOB</label>
            <input type="date" ngModel class="form-control" name="dob" required />
          </div>
          <div class="form-group">
            <label>Student Gender</label>
            <select name="gender" ngModel="OTHER" id="studentGender" title="Select Gender" required>
                <option value="MALE">Male</option>
                <option value="FEMALE">Female</option>
                <option value="OTHER">Other</option>
              </select>
          </div>
        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" id="closeModel" data-bs-dismiss="modal" value="Cancel" />
          <input type="submit" [disabled] ="studentForm.invalid || (isLoading$ | async) " class="btn btn-success" value="Add" />
          <i *ngIf="isLoading$ | async" class="fas fa-spinner fa-spin"></i>
          <span *ngIf="isLoading$ | async" class="sr-only">Saving...</span>
        </div>
      </form>
    </div>
  </div>
</div>

